module tester;

import stdio local;

import c2test local;

const Test[+] Tests;

func void test1() {
}
Tests += { "test1", test1 }

func void test2() {
}
Tests += { "test2", test2 }

// or with simple macro:
#define TEST(x) \
    Tests += { .name=#x, .run=x } \
    func void x()

TEST(test3) {
}

TEST(test4) {
}

public func int32 main() {
    uint32 num_tests = elemsof(Tests);
    printf("running %d tests:\n", num_tests);
    for (uint32 i=0; i<num_tests; i++) {
        printf("  test %u/%u %s: ", i+1, num_tests, Tests[i].name);
        Tests[i].run();
        printf("OK\n");
    }
    return 0;
}

